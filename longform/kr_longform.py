from datetime import datetime
from audio.tts_long import generate_long_narration
from uploader import upload_video
from shorts.shorts_pipeline import run_shorts_pipeline

def run_kr_longform():
    print("ğŸ”µ êµ­ì¥ ë¡±í¼ íŒŒì´í”„ë¼ì¸ ì‹œì‘")

    # -----------------------------
    # 1ï¸âƒ£ ë‚ ì§œ (ë‹¹ì¼ êµ­ì¥)
    # -----------------------------
    target_date = datetime.now().strftime("%Y.%m.%d")

    # -----------------------------
    # 2ï¸âƒ£ ë¡±í¼ ëŒ€ë³¸ ìƒì„± (ì„ì‹œ ì˜ˆì‹œ)
    # ì‹¤ì œë¡œëŠ” GPTë¡œ ìƒì„±í•˜ë„ë¡ êµì²´ ê°€ëŠ¥
    # -----------------------------
    script = f"""
{target_date} êµ­ì¥ ì‹œí™©ì…ë‹ˆë‹¤.

ì˜¤ëŠ˜ ì½”ìŠ¤í”¼ì™€ ì½”ìŠ¤ë‹¥ì€ ê¸€ë¡œë²Œ ì¦ì‹œ íë¦„ê³¼ í™˜ìœ¨, ê¸ˆë¦¬ ì˜í–¥ì„ ë°›ìœ¼ë©° ì›€ì§ì˜€ìŠµë‹ˆë‹¤.
íŠ¹íˆ ì™¸êµ­ì¸ ìˆ˜ê¸‰ê³¼ ë°˜ë„ì²´ ì—…ì¢…ì˜ ë³€ë™ì„±ì´ ì‹œì¥ì„ ì¢Œìš°í–ˆìŠµë‹ˆë‹¤.

ì˜¤ëŠ˜ì˜ í•µì‹¬ ì´ìŠˆ, ì—…ì¢…ë³„ íë¦„, ê·¸ë¦¬ê³  ë‚´ì¼ ì¦ì‹œ ì „ë§ê¹Œì§€
ì°¨ë¶„í•˜ê²Œ ì •ë¦¬í•´ë“œë¦½ë‹ˆë‹¤.
"""

    # -----------------------------
    # 3ï¸âƒ£ TTS + ë¡±í¼ ì˜¤ë””ì˜¤ ìƒì„±
    # -----------------------------
    audio_path = generate_long_narration(script)

    # âš ï¸ ë¡±í¼ ì˜ìƒì€ ë°°ê²½ + ì˜¤ë””ì˜¤ í•©ì„±ëœ ê²°ê³¼ë¼ê³  ê°€ì •
    video_path = "output/long_video.mp4"

    # -----------------------------
    # 4ï¸âƒ£ ìœ íŠœë¸Œ ë¡±í¼ ì—…ë¡œë“œ
    # -----------------------------
    video_id = upload_video(
        video_path=video_path,
        title=f"{target_date} êµ­ì¥ ì‹œí™© - ì˜¤ëŠ˜ ì‹œì¥ì—ì„œ ê¼­ ë´ì•¼ í•  í¬ì¸íŠ¸",
        description=script[:4000],
        tags=[
            "êµ­ì¥ì‹œí™©", "ì½”ìŠ¤í”¼", "ì½”ìŠ¤ë‹¥", "í•œêµ­ì¦ì‹œ",
            "ê²½ì œì‹œí™©", "ì£¼ì‹ì‹œì¥", "í™˜ìœ¨", "ê¸ˆë¦¬"
        ],
        video_type="long"
    )

    print("âœ… êµ­ì¥ ë¡±í¼ ì—…ë¡œë“œ ì™„ë£Œ")

    # -----------------------------
    # 5ï¸âƒ£ ìˆí¼(í•µì‹¬ ìš”ì•½) ìë™ ìƒì„± + ì—…ë¡œë“œ
    # -----------------------------
    run_shorts_pipeline(
        market_type="KR",
        long_script=script,
        title=f"{target_date} êµ­ì¥ ì‹œí™©"
    )

    print("ğŸ‰ êµ­ì¥ ë¡±í¼ + ìˆí¼ ì™„ë£Œ")
